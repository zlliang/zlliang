---
import { groupBy } from 'lodash-es'
import { getYear, format } from 'date-fns'
import { getPosts } from '@/utils/posts'

import Layout from '@/layouts/Layout.astro'
import ImageSlide from '@/components/ImageSlide.astro'

import welcome from '@/assets/images/welcome.gif'

const posts = await getPosts()
const grouped = Object.entries(groupBy(posts, (post) => getYear(post.data.created)))
	.map(([year, posts]) => ({ year, posts: posts.toSorted((a, b) => b.data.created.valueOf() - a.data.created.valueOf()) }))
	.toSorted((a, b) => Number(b.year) - Number(a.year))
---

<Layout>
	<!-- Welcome -->
	<div class="flex flex-col items-center gap-4 my-16">
		<img src={welcome.src} alt="Welcome" width="140" />
	</div>

	<!-- Profile -->
	<div class="mb-16 py-4 space-y-4 bg-slate-50 border border-slate-200">
		<div class="leading-7 px-4">
			æ¬¢è¿ä½ ï¼æˆ‘æ˜¯<strong>å­é¾™</strong>ï¼Œæ¯•ä¸šäº<a href="https://www.fudan.edu.cn/">å¤æ—¦å¤§å­¦</a>æ•°å­¦ä¸“ä¸šï¼Œç›®å‰åœ¨<a href="https://bytedance.com">å­—èŠ‚è·³åŠ¨</a>åš <a href="https://roadmap.sh/frontend">Web å‰ç«¯å¼€å‘</a>å·¥ä½œï¼›åŒæ—¶ï¼Œæˆ‘ä¹Ÿæ˜¯<a href="https://baike.baidu.com/item/%E4%B8%8A%E6%B5%B7%E5%BD%A9%E8%99%B9%E5%AE%A4%E5%86%85%E5%90%88%E5%94%B1%E5%9B%A2">ä¸Šæµ·å½©è™¹å®¤å†…åˆå”±å›¢</a>ç”·é«˜å£°éƒ¨çš„æˆå‘˜ã€‚è¿™é‡Œæ˜¯æˆ‘çš„ç¬”è®°æœ¬ï¼Œæˆ‘ä¼šå†™ä¸€äº›<strong>æˆé•¿æ•…äº‹</strong>ã€<strong>ç”Ÿæ´»æ„Ÿæ‚Ÿ</strong>å’Œ<strong>æŠ€æœ¯æ”¶è·</strong>ï¼Œå¸Œæœ›ä½ å–œæ¬¢ï¼ğŸ‰
		</div>
		<ImageSlide />
	</div>
	
	<!-- Posts -->
	{grouped.map(({ year, posts }) => (
		<div class="my-8">
			<div class="pb-1 mb-2 border-b border-slate-200 text-slate-500 text-sm">{year}</div>
			<div>
				{posts.map((post) => (
					<div class="my-1 flex justify-between gap-4">
						<span>
							<a href={`/posts/${post.id}`}>{post.data.title}</a>
							{post.data.draft === true && <span class="i-lucide-file-pen ml-1 text-slate-500"></span>}
						</span>
						<span class="shrink-0 w-fit text-slate-500">{format(post.data.created, 'M æœˆ d æ—¥')}</span>
					</div>
				))}
			</div>
		</div>
	))}
</Layout>
