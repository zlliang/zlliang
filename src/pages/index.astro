---
import { getCollection } from 'astro:content'
import { groupBy } from 'lodash-es'
import { getYear, format } from 'date-fns'

import Layout from '@/layouts/Layout.astro'

import welcome from '@/assets/images/welcome.gif'

const posts = await getCollection('posts')
const grouped = Object.entries(groupBy(posts, (post) => getYear(post.data.created)))
	.map(([year, posts]) => ({ year, posts }))
	.sort((a, b) => Number(b.year) - Number(a.year))
---

<Layout>
	<!-- Welcome -->
	<div class="flex flex-col items-center gap-4 my-16">
		<img src={welcome.src} alt="Welcome" width="140" />
	</div>
	<!-- Posts -->
	{grouped.map(({ year, posts }) => (
		<div class="my-8">
			<div class="pb-1 mb-2 border-b border-slate-200 text-slate-500 text-sm">{year}</div>
			<div>
				{posts.map((post) => (
					<div class="my-2 flex justify-between gap-4">
						<a href={`/posts/${post.id}`}>{post.data.title}</a>
						<span class="shrink-0 w-fit text-slate-500">{format(post.data.created, 'M æœˆ dd æ—¥')}</span>
					</div>
				))}
			</div>
		</div>
	))}
</Layout>
