---
import { type CollectionEntry } from 'astro:content'
import { format } from 'date-fns'
import { groupByYear, getTags } from '@/utils/posts'

import NewTag from '@/components/NewTag.astro'
import DraftTag from '@/components/DraftTag.astro'
import PostTag from '@/components/PostTag.astro'

interface Props {
  posts: CollectionEntry<'posts'>[]
	showTags?: boolean
}

const { posts, showTags = true } = Astro.props
const groups = groupByYear(posts)
const tags = getTags(posts)
---

<div>
	<!-- Tags -->
	{showTags && tags.length > 0 && (
		<div class="my-8">
			<div class="pb-1 mb-2 border-b border-slate-200 text-slate-500 text-sm">全部标签</div>
			<div class="inline-flex flex-wrap gap-2">
				{tags.map((tag) => (
					<PostTag href={`/posts/tags/${tag}`}>{tag}</PostTag>
				))}
			</div>
		</div> 
	)}

	<!-- Posts -->
	{groups.map(({ year, posts }) => (
		<div class="my-8">
			<div class="pb-1 mb-2 border-b border-slate-200 text-slate-500 text-sm">{year}</div>
			<div>
				{posts.map((post) => (
					<div class="my-1 flex justify-between gap-4">
						<span>
							<a href={`/posts/${post.id}`}>{post.data.title}</a>
							{post.data.new === true && <NewTag class="ml-1" />}
							{post.data.draft === true && <DraftTag class="ml-1" />}
						</span>
						<span class="shrink-0 w-fit text-slate-500">
							{showTags && post.data.tags && post.data.tags.length > 0 && (
								<span class="inline-flex gap-2 mr-2">
									{post.data.tags.map((tag) => (
										<PostTag href={`/posts/tags/${tag}`}>{tag}</PostTag>
									))}
								</span>
							)}
							<span>{format(post.data.created, 'M 月 d 日')}</span>
						</span>
					</div>
				))}
			</div>
		</div>
	))}
</div>
