---
import { getEntry } from "astro:content"
import { format } from "date-fns"

import Layout from "@/components/Layout.astro"
import NoteItem from "@/components/NoteItem.astro"
import Link from "@/components/Link.astro"

import { notes } from "@/utils/content"
import { cn } from "@/utils/style"

import type { GetStaticPaths } from "astro"

export const getStaticPaths = (() => notes.map((note, index) => {
  const next = index > 0 ? notes[index - 1] : null
  const previous = index < notes.length - 1 ? notes[index + 1] : null

  return {
    params: { slug: note.id },
    props: { note, next, previous },
  }
})) satisfies GetStaticPaths

const { note, next, previous } = Astro.props
const post = note.data.post ? await getEntry(note.data.post) : null

const title = [note.data.title || post?.data.title, `手记 #${note.data.no}`].filter(Boolean).join(" - ")
---

<Layout title={title}>
  <!-- Content -->
  <NoteItem note={note} showLink={false} />

  <!-- Links to next and previous notes -->
  {(next || previous) && (
    <div class="grid grid-cols-2 mt-16">
      {next && (
        <div class={cn("col-start-1 pr-4 text-neutral-500", !previous && "border-r border-neutral-200 dark:border-neutral-800")} >
          <div class="text-sm mb-0.5">下一则</div>
          <Link href={`/notes/${next.id}`} class="block mb-0.5">{next.data.title || "无题手记"}</Link>
          <div class="text-sm">
            <span>{format(next.data.created, "yyyy 年 M 月 d 日")}</span><span class="icon-[lucide--dot]" /><span class="font-mono">#days{next.data.no}</span>
          </div>
        </div>
      )}
      {previous && (
        <div class="col-start-2 pl-4 border-l border-neutral-200 dark:border-neutral-800 text-right text-neutral-500">
          <div class="text-sm mb-0.5">上一则</div>
          <Link href={`/notes/${previous.id}`} class="block mb-0.5">{previous.data.title || "无题手记"}</Link>
          <div class="text-sm">
            <span class="font-mono">#days{previous.data.no}</span><span class="icon-[lucide--dot]" /><span>{format(previous.data.created, "yyyy 年 M 月 d 日")}</span>
          </div>
        </div>
      )}
    </div>
  )}
</Layout>
